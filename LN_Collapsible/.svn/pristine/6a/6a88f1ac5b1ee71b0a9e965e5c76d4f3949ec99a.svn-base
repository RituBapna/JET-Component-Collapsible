/*
 Copyright (c) 2014, Oracle and/or its affiliates.
 All rights reserved.
 Copyright (c) 2014, Oracle and/or its affiliates.
 All rights reserved.
 Copyright (c) 2014, Oracle and/or its affiliates.
 All rights reserved.
 Copyright (c) 2014, Oracle and/or its affiliates.
 All rights reserved.
*/
define(["ojs/ojcore","jquery","ojs/ojdatacollection-common","ojs/ojmodel"],function(a){a.uc=function(f,c,b,d,e){a.i.dc(f,null);a.i.dc(c,null);a.i.dc(b,null);a.i.dc(d,null);a.i.Vn(e);this.tf=f;this.Qj=c;this.Ag=b;this.Pj=d;this.Ic=e};o_("CollectionCellSet",a.uc,a);a.uc.prototype.DI=function(f){a.i.Cr(f);null!=f&&f.length===this.Z("row")&&(this.Sj=f)};a.uc.prototype.getData=function(a){var c;c=this.bc(a);return null==c?null:c.get(this.Ic[a.column])};a.b.g("CollectionCellSet.prototype.getData",{getData:a.uc.prototype.getData});
a.uc.prototype.getMetadata=function(f){var c;c=this.bc(f);return null==c?null:{keys:{row:a.Ri.Ek(c),column:this.Ic[f.column]}}};a.b.g("CollectionCellSet.prototype.getMetadata",{getMetadata:a.uc.prototype.getMetadata});a.uc.prototype.bc=function(f){var c;if(null==this.Sj)return null;a.i.je(f);c=f.row;f=f.column;a.i.assert(c>=this.tf&&c<=this.Qj&&f>=this.Ag&&f<=this.Pj);return this.Sj[c-this.tf]};a.uc.prototype.Z=function(a){return"row"===a?Math.max(0,this.Qj-this.tf):"column"===a?Math.max(0,this.Pj-
this.Ag):0};a.b.g("CollectionCellSet.prototype.getCount",{Z:a.uc.prototype.Z});a.uc.prototype.getStartRow=function(){return this.tf};a.b.g("CollectionCellSet.prototype.getStartRow",{getStartRow:a.uc.prototype.getStartRow});a.uc.prototype.qH=function(){return this.Qj};a.b.g("CollectionCellSet.prototype.getEndRow",{qH:a.uc.prototype.qH});a.uc.prototype.getStartColumn=function(){return this.Ag};a.b.g("CollectionCellSet.prototype.getStartColumn",{getStartColumn:a.uc.prototype.getStartColumn});a.uc.prototype.pH=
function(){return this.Pj};a.b.g("CollectionCellSet.prototype.getEndColumn",{pH:a.uc.prototype.pH});a.uc.prototype.yi=function(){return this.Ic};a.b.g("CollectionCellSet.prototype.getColumns",{yi:a.uc.prototype.yi});a.Ri=function(){};a.Ri.Ek=function(a){var c;c=a.we();null==c&&(c=a.bk());return c};a.Jc=function(f,c,b,d){a.i.dc(f,null);a.i.dc(c,null);a.i.Vn(b);this.tc=f;this.Qf=c;this.bs=b;this.sf=d};o_("CollectionHeaderSet",a.Jc,a);a.Jc.prototype.DI=function(f){a.i.Cr(f);null!=f&&f.length===this.Z()&&
(this.Sj=f)};a.Jc.prototype.getData=function(f){a.i.assert(f<=this.Qf&&f>=this.tc);if(null!=this.sf){if(null==this.Sj)return null;f=this.Sj[f-this.tc];return f.get(this.sf)}return this.bs[f]};a.b.g("CollectionHeaderSet.prototype.getData",{getData:a.Jc.prototype.getData});a.Jc.prototype.getMetadata=function(f){if(null!=this.sf){if(null==this.Sj)return null;f=this.Sj[f-this.tc];return{key:a.Ri.Ek(f)}}return{key:this.getData(f)}};a.b.g("CollectionHeaderSet.prototype.getMetadata",{getMetadata:a.Jc.prototype.getMetadata});
a.Jc.prototype.Z=function(){return Math.max(0,this.Qf-this.tc)};a.b.g("CollectionHeaderSet.prototype.getCount",{Z:a.Jc.prototype.Z});a.Jc.prototype.Ga=function(){return this.tc};a.b.g("CollectionHeaderSet.prototype.getStart",{Ga:a.Jc.prototype.Ga});a.Jc.prototype.oH=function(){return this.Qf};a.b.g("CollectionHeaderSet.prototype.getEnd",{oH:a.Jc.prototype.oH});a.Jc.prototype.vH=function(){return this.bs};a.b.g("CollectionHeaderSet.prototype.getHeaders",{vH:a.Jc.prototype.vH});a.Jc.prototype.co=function(){return this.sf};
a.b.g("CollectionHeaderSet.prototype.getRowHeader",{co:a.Jc.prototype.co});a.ea=function(f,c){this.na=f;null!=c&&(this.Ni=c.rowHeader,this.columns=c.columns);this.O=0;this.Ra=-1;a.ea.t.constructor.call(this)};o_("CollectionDataGridDataSource",a.ea,a);a.b.qa(a.ea,a.Hb,"oj.CollectionDataGridDataSource");a.ea.prototype.Init=function(){a.ea.t.Init.call(this);this.Fl={};this.Cv()||(null==this.columns&&0<this.na.length?(this.columns=this.na.first().keys(),-1!=this.columns.indexOf(this.Ni)&&this.columns.splice(this.columns.indexOf(this.Ni),
1)):this.columns=[]);this.tS()};a.b.g("CollectionDataGridDataSource.prototype.Init",{Init:a.ea.prototype.Init});a.ea.prototype.tS=function(){this.na.on("add",this.YP.bind(this));this.na.on("remove",this.LC.bind(this));this.na.on("change",this.ZP.bind(this));this.na.on("refresh",this.BP.bind(this))};a.ea.prototype.Cv=function(){return null!=this.na.url||null!=this.na.customURL};a.ea.prototype.MQ=function(){return this.Cv()?null!=this.data:!0};a.ea.prototype.kD=function(a){if(this.Cv()){if("column"===
a)return null!=this.columns;if("row"===a&&null!=this.Ni)return null!=this.data}return!0};a.ea.prototype.Z=function(a){if(!this.kD(a))return this.precision="estimate",-1;this.precision="exact";return"row"==a?this.size():"column"==a?this.columns.length:0};a.b.g("CollectionDataGridDataSource.prototype.getCount",{Z:a.ea.prototype.Z});a.ea.prototype.nf=function(a){null==this.precision&&this.Z(a);return this.precision};a.b.g("CollectionDataGridDataSource.prototype.getCountPrecision",{nf:a.ea.prototype.nf});
a.ea.prototype.Vd=function(a,c,b){var d,e;d=a.axis;this.kD(d)?this.KC(a,c,b):null!=c&&(e={},e.yV=a,e.callbacks=c,e.Yw=b,this.Fl[d]=e)};a.b.g("CollectionDataGridDataSource.prototype.fetchHeaders",{Vd:a.ea.prototype.Vd});a.ea.prototype.KC=function(f,c,b,d){var e,g,h,k;e=f.axis;g=f.start;h=f.count;a.i.assert("row"===e||"column"===e);a.i.assert(0<h);if("column"===e)null!=this.columns?(d=Math.min(this.columns.length,g+h),k=new a.Jc(g,d,this.columns)):k=new a.ve(g,g,e,null);else if("row"===e){if(null!=
this.Ni){null!=d&&(h=d.count);d=Math.min(this.size(),g+h);0<this.Ra&&(d=Math.min(d,this.totalSize()-this.O));k=new a.Jc(g,d,this.columns,this.Ni);this.dF(g,d,k,f,c,b);return}k=new a.ve(g,g,e,null)}null!=c&&c.success&&c.success.call(b.success,k,f);this.Fl[e]=null};a.ea.prototype.qC=function(f){var c,b,d,e,g,h;for(c=0;c<f.length;c+=1)b=f[c],a.i.assert("row"===b.axis||"column"===b.axis),a.i.assert(0<b.count),"row"===b.axis?(d=b.start,e=b.count):"column"===b.axis&&(g=b.start,h=b.count);return{rowStart:d,
rowCount:e,colStart:g,colCount:h}};a.ea.prototype.IC=function(f,c,b,d){var e,g,h;e=this.qC(f);g=e.rowStart;d=null!=d?Math.min(this.size(),g+d.count):Math.min(this.size(),g+e.rowCount);h=e.colStart;e=Math.min(this.columns.length,h+e.colCount);0<this.Ra&&(d=Math.min(d,this.totalSize()-this.O));e=new a.uc(g,d,h,e,this.columns);this.dF(g,d,e,f,c,b)};a.ea.prototype.dF=function(a,c,b,d,e,g){var h;for(h=[];a<c;a++)h.push(this.na.at(a+this.O,{deferred:!0}));Promise.all(h).then(function(a){b.DI(a);e.success.call(g.success,
b,d)})};a.ea.prototype.Td=function(a,c,b){this.MQ()?this.IC(a,c,b):(null!=c&&(this.Fg={},this.Fg.BU=a,this.Fg.callbacks=c,this.Fg.Yw=b),this.gO(a))};a.b.g("CollectionDataGridDataSource.prototype.fetchCells",{Td:a.ea.prototype.Td});a.ea.prototype.nE=function(a){var c,b,d,e,g;c=this.Fl[a];null!=c&&(b=c.yV,d=c.callbacks,e=c.Yw,"row"===a&&(g=c.Vw),this.KC(b,d,e,g))};a.ea.prototype.bS=function(){this.IC(this.Fg.BU,this.Fg.callbacks,this.Fg.Yw,this.Fg.Vw)};a.ea.prototype.gO=function(a){var c;a=this.qC(a);
c=a.rowStart;0<this.Ra&&(c+=this.O);this.na.ps(c,a.rowCount).then(function(a){var d=this.na.at(c,{deferred:!0});this.cT(a.start,a.count);null!=d&&void 0===this.columns?d.then(function(a){this.vw(a);this.IB()}.bind(this)):this.IB()}.bind(this))};a.ea.prototype.IB=function(){null!=this.Fl&&(this.nE("column"),this.nE("row"));null!=this.Fg&&this.bS();0<this.Ra&&a.Hb.t.handleEvent.call(this,"sync",!0)};a.ea.prototype.cT=function(a,c){var b={start:a,count:c};null!=this.Fl.row&&(this.Fl.row.Vw=b);null!=
this.Fg&&(this.Fg.Vw=b)};a.ea.prototype.vw=function(a){this.columns=a.keys();-1!=this.columns.indexOf(this.Ni)&&this.columns.splice(this.columns.indexOf(this.Ni),1)};a.ea.prototype.keys=function(f){var c,b,d,e,g;c=f.row+this.O;b=f.column;var h=this;return a.b.ma(function(f){g=h.na.at(c,{deferred:!0});null!=g?g.then(function(c){d=a.Ri.Ek(c);null==h.columns&&h.vw(c);e=h.columns[b];f({row:null==d?null:d,column:null==e?null:e})}.bind(h)):f({row:null,column:null})})};a.b.g("CollectionDataGridDataSource.prototype.keys",
{keys:a.ea.prototype.keys});a.ea.prototype.Xd=function(f){var c,b,d;c=f.row;b=f.column;var e=this;return a.b.ma(function(a){e.na.indexOf(c,{deferred:!0}).then(function(c){null==e.columns&&e.na.first(1,{deferred:!0}).then(function(a){e.vw(a)}.bind(e));d=e.columns.indexOf(b);a({row:null==c?-1:c,column:null==d?-1:d})}.bind(e))})};a.b.g("CollectionDataGridDataSource.prototype.indexes",{Xd:a.ea.prototype.Xd});a.ea.prototype.getCapability=function(a){return"sort"===a?"column":"move"===a?"row":null};a.b.g("CollectionDataGridDataSource.prototype.getCapability",
{getCapability:a.ea.prototype.getCapability});a.ea.prototype.sort=function(a,c,b){var d,e=a.direction,g=a.key;a=a.axis;null==b&&(b={});"column"===a?(-1<this.na.mx&&this.na.hasMore?(this.na.comparator=g,this.na.sortDirection="ascending"===e?1:-1):("ascending"===e&&(d=function(a,b){var c,d;a=a.get(g);b=b.get(g);c=isNaN(a);d=isNaN(b);a instanceof Date&&(a=a.toISOString(),c=!0);b instanceof Date&&(b=b.toISOString(),d=!0);return c&&d?a<b?-1:a===b?0:1:c?1:d?-1:a-b}),"descending"===e&&(d=function(a,b){var c,
d;a=a.get(g);b=b.get(g);c=isNaN(a);d=isNaN(b);a instanceof Date&&(a=a.toISOString());b instanceof Date&&(b=b.toISOString());return c&&d?a>b?-1:a===b?0:1:c?-1:d?1:b-a}),this.na.comparator=d),this.na.sort(),null!=c&&null!=c.success&&c.success.call(b.success)):null!=c&&null!=c.error&&c.error.call(b.error,"Axis value not supported")};a.b.g("CollectionDataGridDataSource.prototype.sort",{sort:a.ea.prototype.sort});a.ea.prototype.move=function(a,c){var b;this.na.get(a,{deferred:!0}).then(function(d){null==
c?(this.na.remove(d),this.na.add(d)):(a===c?(b=this.na.indexOf(c,{deferred:!0}),this.na.remove(d)):(this.na.remove(d),b=this.na.indexOf(c,{deferred:!0})),b.then(function(a){this.na.add(d,{at:a,XX:!0})}.bind(this)))}.bind(this))};a.b.g("CollectionDataGridDataSource.prototype.move",{move:a.ea.prototype.move});a.ea.prototype.pq=function(a,c,b,d){var e={source:this};e.operation=a;e.keys={row:c,column:null};e.indexes={row:b,column:d};return e};a.ea.prototype.YP=function(f){var c,b;this.na.indexOf(f,{deferred:!0}).then(function(d){b=
a.Ri.Ek(f);c=this.pq("insert",b,0<d-this.O?d-this.O:0,-1);this.handleEvent("change",c);d<this.Ra+this.O&&(d=this.na.at(this.O+this.Ra,{deferred:!0}),null!=d&&d.then(function(a){null!=f&&this.LC(a)}.bind(this)))}.bind(this))};a.ea.prototype.LC=function(f){this.handleEvent("change",this.pq("delete",a.Ri.Ek(f)))};a.ea.prototype.ZP=function(f){var c,b;this.na.indexOf(f,{deferred:!0}).then(function(d){b=a.Ri.Ek(f);d=0<d-this.O?d-this.O:-1;c=this.pq("update",b,d,-1);this.handleEvent("change",c)}.bind(this))};
a.ea.prototype.BP=function(){this.handleEvent("change",this.pq("refresh",null))};a.ea.prototype.setPageSize=function(a){this.Ra=a};a.b.g("CollectionDataGridDataSource.prototype.setPageSize",{setPageSize:a.ea.prototype.setPageSize});a.ea.prototype.size=function(){return 0===this.na.length?-1:null!=this.Ra&&0<this.Ra&&this.na.size()>this.Ra?this.Ra:this.na.size()};a.b.g("CollectionDataGridDataSource.prototype.size",{size:a.ea.prototype.size});a.ea.prototype.totalSize=function(){return null!=this.na?
this.na.totalResults:-1};a.b.g("CollectionDataGridDataSource.prototype.totalSize",{totalSize:a.ea.prototype.totalSize});a.ea.prototype.hasMore=function(){return null!=this.na?this.na.hasMore:!1};a.b.g("CollectionDataGridDataSource.prototype.hasMore",{hasMore:a.ea.prototype.hasMore});a.ea.prototype.fetch=function(a){this.O=null!=a?null!=a.startIndex?a.startIndex:0:0;this.handleEvent("change",{operation:"sync",pageSize:this.Ra})};a.ea.prototype.getCollection=function(){return this.na};a.b.g("CollectionDataGridDataSource.prototype.getCollection",
{getCollection:a.ea.prototype.getCollection});a.ea.prototype.yi=function(){return this.columns};a.b.g("CollectionDataGridDataSource.prototype.getColumns",{yi:a.ea.prototype.yi});a.ea.prototype.co=function(){return this.Ni};a.b.g("CollectionDataGridDataSource.prototype.getRowHeader",{co:a.ea.prototype.co});a.ea.prototype.BH=function(){return this.O};a.b.g("CollectionDataGridDataSource.prototype.getStartIndex",{BH:a.ea.prototype.BH});a.ea.prototype.wH=function(){return this.Ra};a.b.g("CollectionDataGridDataSource.prototype.getPageSize",
{wH:a.ea.prototype.wH});a.ea.prototype.getData=function(){return this.data};a.b.g("CollectionDataGridDataSource.prototype.getData",{getData:a.ea.prototype.getData})});
//# sourceMappingURL=oj-modular.map