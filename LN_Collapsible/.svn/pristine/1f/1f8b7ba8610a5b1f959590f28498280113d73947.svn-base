/*
 Copyright (c) 2014, Oracle and/or its affiliates.
 All rights reserved.
*/
define(["ojs/ojcore","jquery","knockout"],function(a,f,c){function b(a,b,c,d){"dayMetaData"===a&&d({dayFormatter:b?function(a){return q(b,0,[a.fullYear,a.month,a.date])}:null})}function d(a,b){var c={};c.value=b.value;return c}function e(a,b){var c={},d=b.optionMetadata;d&&"shouldWrite"===d.writeback&&(c[b.option]=b.value);return c}function g(){this.Init()}function h(a,b,c){this.Init(a,b,c)}function k(a,b){return function(d){var e,g;e=d.parentElement;g=a.createChildContext(d.data,null,function(a){a.$key=
d.key;a.$metadata=d.metadata;a.$headerContext=d});c.renderTemplate(b,g,null,e);return null}}function l(a,b){return function(d){var e,g;e=d.parentElement;g=a.createChildContext(d.data,null,function(a){a.$keys=d.keys;a.$metadata=d.metadata;a.$cellContext=d});c.renderTemplate(b,g,null,e);return null}}function m(a,b,d){var e={};(function(b,d){e=function(e){var g=null,f=null;"header"==d?(g=a.extend({$column:e.column,$headerContext:e.headerContext}),f=e.headerContext.parentElement):"cell"==d&&(g=a.createChildContext(e.row,
null,function(a){a.$column=e.column;a.$cellContext=e.cellContext}),f=e.cellContext.parentElement);"footer"==d&&(g=a.extend({$column:e.column,$footerContext:e.footerContext}),f=e.footerContext.parentElement);c.renderTemplate(b,g,null,f,"replaceNode")}})(d,b);return e}function n(a,b){return function(d){var e=a.createChildContext(d.row,null,function(a){a.$rowContext=d.rowContext});c.renderTemplate(b,e,null,d.rowContext.parentElement,"replaceNode")}}function q(a,b,c){if(!a||b===c.length)return a;var d=
b+1;return q(a[c[b]],d,c)||q(a["*"],d,c)}a.ia=function(a,b){this.Init(a,b)};o_("ComponentBinding",a.ia,a);a.b.qa(a.ia,a.b,"oj.ComponentBinding");a.ia.create=function(b,d){if(null==b)throw"Binding name is required!";var e=new a.ia(b,d),g=c.bindingHandlers,f,h=Array.isArray(b)?b:[b];for(f=0;f<h.length;f++)g[h[f]]=e;return e};o_("ComponentBinding.create",a.ia.create,a);a.ia.xh=function(){return a.ia.kK};o_("ComponentBinding.getDefaultInstance",a.ia.xh,a);a.ia.prototype.Hh=function(a){var b=a["for"],
b=null==b?"@global":b,c=this.Nq[b]||[];c.push(a);this.Nq[b]=c};a.b.g("ComponentBinding.prototype.setupManagedAttributes",{Hh:a.ia.prototype.Hh});a.ia.jx=function(){a.ia.GA.jx()};o_("ComponentBinding.deliverChanges",a.ia.jx,a);a.ia.prototype.Init=function(b,c){a.ia.t.Init.call(this);"string"===typeof c&&(c={componentName:c});this.vt=c||{};this.oM=Array.isArray(b)?b:[b];this.init=a.b.Yn(this,this._init);this.update=a.b.Yn(this,this.Qn);this.Nq={}};a.ia.Ws="_ojNeedsJUIBInit";a.ia.prototype._init=function(b,
d,e,g,h){c.applyBindingsToDescendants(h,b);f(b).data(a.ia.Ws,!0);return{controlsDescendantBindings:!0}};a.ia.prototype.Qn=function(b,c,d,e,g){e=f(b);e.data(a.ia.Ws)&&(e.data(a.ia.Ws,null),this.WC(b,e,c,d,g))};a.ia.prototype.WC=function(b,g,f,l,k){var m=f(),n=null,q=!1,D=[],A=null,H=null,I=a.ia.wO(this.oM,b,k),z=0,K={},x=this.vt.componentName;if(null==x){n="component";if(!I[n]&&(n="role",!I[n])){a.C.error("component attribute is required for the ojComponent binding");return}var B=m[n];if(null==B){a.C.error("non-null component attribute is required for the ojComponent binding");
return}c.computed(function(){a.ia.ou(I[n],n,K,k,!1);if(0==z)x=c.utils.unwrapObservable(B);else{q=!0;I=null;a.ia.VT(g);if(H){A.YG();A=null;var d=this.vt.beforeDestroy;d&&d(b,H,f,l,k);H("destroy");H=null;for(d=0;d<D.length;d++)D[d].YG();D=null}this.WC(b,g,f,l,k)}return null},this,{disposeWhenNodeIsRemoved:b})}if(null!=x)if(H=g[x],"function"===typeof H){var H=H.bind(g),P=a.ia.cF(this.Nq,I,x),J={},E=a.ia.xh();this!==E&&(E=E.WO(I,x),a.jc.kf(E,P),P=E);for(var F={},A=new h(H,b,a.ia.GA),E={"^slider$":[{event:"slidechange",
getter:d}],"^oj*":[{event:"ojoptionchange",getter:e}]},N=function(){var c=this.eS,d=I[c];d&&a.ia.ou(d,c,K,k,!1);if(0===z){var d=a.ia.cG(m[c]),e=P[c];null!=e?(J[c]=e,e=e.BV,null!=e&&(c=e(c,d,b,H,f,l,k)||{},a.jc.kf(F,c))):F[c]=d}else if(!q)if(d=a.ia.cG(f()[c]),null!=P[c]){if(e=P[c].update,null!=e)for(c=e(c,d,b,H,f,l,k)||{},d=Object.keys(c),e=0;e<d.length;e++){var g=d[e];A.zG(g,c[g])}}else A.zG(c,d);return null},O,G=Object.keys(m),C=0;C<G.length;C++)O=G[C],O!==n&&D.push(c.computed(N,{eS:O},{disposeWhenNodeIsRemoved:b}));
a.ia.vS(g,x,E,f,I,A,k);E=a.ia.FB(F);H(F);for(var S in E)H("option",S,E[S]);(S=this.vt.afterCreate)&&S(b,H,f,l,k);a.ia.GN(J,b,H,f,l,k);F=null}else a.C.error("Component %s is not found",x);z=1};a.ia.wO=function(a,b,d){var e={},g=null,g=c.bindingProvider.instance,f;f=null;var l,g=g.eV?g.eV(b,d):b.getAttribute("data-bind");if(!g)return e;b=c.jsonExpressionRewriting.parseObjectLiteral(g);d=/^(\s|\u00A0)+|(\s|\u00A0)+$/g;for(g=0;g<b.length;g+=1){l=b[g];var h=l.key.replace(d,"");if(0<=a.indexOf(h)){f=l.value;
break}}if(!f)return e;b=c.jsonExpressionRewriting.parseObjectLiteral(f);for(a=0;a<b.length;a+=1)f=b[a],e[f.key.replace(d,"")]=f.value.replace(d,"");return e};a.ia.ou=function(a,b,c,d,e){var g=c[b];if(void 0===g){"string"!==typeof a&&(a=a());var g=null,f=!0;null!==a&&(!e&&(e=a.charAt(0),"'"===e||'"'===e||0>=a.indexOf("("))&&(f=!1),f&&(g=new Function("$context","with($context){with($data||{}){return "+a+";}}")));c[b]=g}return g?g(d):null};a.ia.prototype.WO=function(b,c){return a.ia.cF(this.Nq,b,c)};
a.ia.cF=function(a,b,c){function d(b){b=a[b];if(null!=b)for(var c=b.length-1;0<=c;c--){var e=b[c];null!=e.attributes&&g.push(e);e=e.use;if(null!=e)for(var e=Array.isArray(e)?e:[e],f=0;f<e.length;f++)d(e[f])}}var e={},g=[];d(c);c=f.oj[c];if(null!=c)for(c=Object.getPrototypeOf(c.prototype);null!=c&&"oj"===c.namespace;)d(c.widgetName),c=Object.getPrototypeOf(c);(c=a["@global"])&&g.push(c);if(0<g.length)for(b=Object.keys(b),c=0;c<b.length;c++)for(var l=b[c],h=0;h<g.length;h++){var k=g[h];if(0<=k.attributes.indexOf(l)){e[l]=
{BV:k.init,update:k.update,oU:k.afterCreate};break}}return e};a.ia.hz=".ojWriteback";a.ia.VT=function(b){b&&b.off(a.ia.hz)};a.ia.vS=function(b,c,d,e,g,f,l){var h={},k;for(k in d)if(c.match(k)){c=d[k];for(d=0;d<c.length;d++)k=c[d],b.on(k.event+a.ia.hz,{xV:k.getter},function(b,c){b.stopPropagation();var d=b.data.xV(b,c);f.EW();try{for(var p in d)a.ia.jU(p,e()[p],d[p],g[p],l,h)}finally{f.iW()}});break}};a.ia.iP=function(a){var b=["true","false","null","undefined"];if(null==a||0<=b.indexOf(a))return null;
b=a.match(/^(?:[$_a-z][$\w]*|(.+)(\.\s*[$_a-z][$\w]*|\[.+\]))$/i);return null===b?null:"function(v){"+(b[1]?"Object("+b[1]+")"+b[2]:a)+"\x3dv;}"};a.ia.jU=function(b,d,e,g,f,l){null!=d&&c.isObservable(d)?c.isWriteableObservable(d)&&d(e):(b=a.ia.ou(function(){return a.ia.iP(g)},b,l,f,!0))&&b(e)};a.ia.cG=function(b){b=c.utils.unwrapObservable(b);(Array.isArray(b)||a.jc.isPlainObject(b))&&b.ojConvertToJS&&(b=c.toJS(b));return b};a.ia.FB=function(a){var b={},c;for(c in a)0<=c.indexOf(".")&&(b[c]=a[c]);
for(var d in b)delete a[d];return b};a.ia.GN=function(a,b,c,d,e,g){for(var f=Object.keys(a),l=0;l<f.length;l++){var h=f[l],k=a[h].oU;k&&k(h,b,c,d,e,g)}};a.b.qa(g,a.b,"ComponentBinding.GlobalChangeQueue");g.prototype.Init=function(){g.t.Init.call(this);this.bj=[]};g.prototype.eW=function(b){-1===this.bj.indexOf(b)&&(this.bj.push(b),this.Up||(this.Up=setTimeout(a.b.Yn(this,this.qB),1)))};g.prototype.fW=function(a){a=this.bj.indexOf(a);0<=a&&this.bj.splice(a,1)};g.prototype.jx=function(){this.Up&&clearTimeout(this.Up);
this.qB()};g.prototype.qB=function(){var a;this.Up=null;try{for(a=0;a<this.bj.length;a+=1)this.bj[a]()}finally{this.bj=[]}};a.b.qa(h,a.b,"ComponentBinding.ComponentChangeTracker");h.prototype.Init=function(b,c,d){h.t.Init.call(this);this.Pa=b;this.ZN=c;this.tE=d;this.kG=a.b.Yn(this,this.cM);this.Ip={};this.dl=0};h.prototype.zG=function(a,b){this.SQ()||this.ON||(this.Ip[a]=b,this.tE.eW(this.kG))};h.prototype.YG=function(){this.tE.fW(this.kG);this.ON=!0};h.prototype.iW=function(){a.i.assert(0<this.dl,
"ComponentChangeTracker._suspendCount underflow");this.dl-=1};h.prototype.EW=function(){this.dl+=1};h.prototype.SQ=function(){return 1<=this.dl};h.prototype.cM=function(){try{if(null!=a.Components.Vr(this.ZN)){var b=a.ia.FB(this.Ip),c={changed:!0};this.Pa("option",this.Ip,c);for(var d in b)this.Pa("option",d,b[d],c)}}finally{this.Ip={}}};a.ia.GA=new g;a.ia.kK=a.ia.create(["ojComponent","jqueryUI"]);a.Ix={};o_("koStringTemplateEngine",a.Ix,a);a.Ix.GV=function(){function a(c){this.el=c;this.text=function(a){if(!a)return b[this.el];
b[this.el]=a};this.data=function(a,b){d[this.el]||(d[this.el]={});if(1===arguments.length)return d[this.el][a];d[this.el][a]=b}}var b={},d={},e=new c.nativeTemplateEngine;e.makeTemplateSource=function(b,d){if("string"==typeof b){d=d||document;var e=d.getElementById(b);return e?new c.templateSources.domElement(e):new a(b)}if(b&&1==b.nodeType||8==b.nodeType)return new c.templateSources.anonymousTemplate(b)};c.templates=b;c.setTemplateEngine(e)};o_("koStringTemplateEngine.install",a.Ix.GV,a);a.ia.xh().Hh({attributes:["header",
"cell"],init:function(a,b,c,d,e,g,f){"header"===a?(a=b.row,null!=a&&(c=a.template,null!=c&&(a.renderer=k(f,c))),a=b.column,null!=a&&(c=a.template,null!=c&&(a.renderer=k(f,c))),d({header:b})):"cell"===a&&(a=b.template,null!=a&&(b.renderer=l(f,a)),d({cell:b}))},update:function(a,b,c,d,e,g,f){return"header"===a?(a=b.row,null!=a&&(c=a.template,null!=c&&(a.renderer=k(f,c))),a=b.column,null!=a&&(c=a.template,null!=c&&(a.renderer=k(f,c))),{header:b}):"cell"===a?(a=b.template,null!=a&&(b.renderer=l(f,a)),
{cell:b}):null},"for":"ojDataGrid"});c.bindingHandlers.ojContextMenu={update:function(a,b){f(a).off(".ojContextMenu");var d=c.utils.unwrapObservable(b());"string"!==f.type(d)&&(d=a.getAttribute("contextmenu"))&&(d="#"+d);d&&(d=f(d).data("oj-ojMenu"));if(d){var e=f(a);e.on("keydown.ojContextMenu contextmenu.ojContextMenu",function(a){return"contextmenu"===a.type||121==a.which&&a.shiftKey?(d.open(a,{launcher:e,initialFocus:"menu"}),!1):!0})}}};a.ia.xh().Hh({attributes:["columns","columnsDefault","rowTemplate"],
init:function(a,b,c,d,e,g,f){if("columns"==a||"columnsDefault"==a){var l;for(c=0;c<b.length;c++){var h=b[c];e=h.template;g=h.footerTemplate;l=h.headerTemplate;null!=e&&(h.renderer=m(f,"cell",e));null!=g&&(h.footerRenderer=m(f,"footer",g));null!=l&&(h.headerRenderer=m(f,"header",l))}"columns"==a?d({columns:b}):d({columnsDefault:b})}else"rowTemplate"==a&&d({rowRenderer:n(f,b)})},update:function(a,b,c,d,e,g,f){if("columns"==a||"columnsDefault"==a){var l;for(c=0;c<b.length;c++){var h=b[c];e=h.template;
g=h.footerTemplate;l=h.headerTemplate;null!=e&&(h.renderer=m(f,"cell",e));null!=g&&(h.footerRenderer=m(f,"footer",g));null!=l&&(h.headerRenderer=m(f,"header",l))}"columns"==a?d({columns:b}):d({columnsDefault:b})}else if("rowTemplate"==a)return{rowRenderer:n(f,b)};return null},"for":"ojTable"});a.ia.xh().Hh({"for":"ojDayMetaData",attributes:["dayMetaData"],init:b,update:b});a.ia.xh().Hh({"for":"ojInputDateTime",use:"ojDayMetaData"});a.ia.xh().Hh({"for":"ojInputDate",use:"ojDayMetaData"});a.ia.xh().Hh({"for":"ojInputTime",
use:"ojDayMetaData"})});
//# sourceMappingURL=oj-modular.map