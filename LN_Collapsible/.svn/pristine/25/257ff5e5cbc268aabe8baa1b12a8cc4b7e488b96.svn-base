/*
 Copyright 2013 jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
 Copyright (c) 2014, Oracle and/or its affiliates.
 All rights reserved.
*/
define(["ojs/ojcore","jquery","ojs/ojcomponentcore"],function(a,f){(function(){a.Ia("oj.ojMenu",f.oj.baseComponent,{defaultElement:"\x3cul\x3e",delay:300,role:"menu",widgetEventPrefix:"oj",ip:"ojMenuClickAwayHandler",options:{menuSelector:"ul",openOptions:{initialFocus:"menu",launcher:null,position:{my:"start top",at:"start bottom"}},submenuOpenOptions:{position:{my:"start top",at:"end top"}},beforeOpen:null,select:null},_create:function(){this._focusForTesting=this.Od;this._nextForTesting=this.TD;
this._selectForTesting=this.ng;this.Jj=this.element;this.Ox=!1;this.element.uniqueId().addClass("oj-menu oj-component").toggleClass("oj-menu-icons",!!this.element.find(".oj-component-icon").length).attr({role:this.role,tabIndex:"0"});this._on(!0,{"mousedown .oj-menu-item":function(a){this.options.disabled&&a.preventDefault()},click:function(a){this.options.disabled&&a.preventDefault()},keydown:function(a){this.options.disabled&&a.keyCode===f.ui.keyCode.ESCAPE&&this.Kb&&this.wu(a)}});this.options.disabled&&
this.element.addClass("oj-disabled").attr("aria-disabled","true");this._on({"mousedown .oj-menu-item \x3e a":function(a){a.preventDefault()},"click .oj-disabled \x3e a":function(a){a.preventDefault()},click:function(){this.Ox=!1},"click .oj-menu-item:has(a)":function(a){var c=f(a.target).closest(".oj-menu-item");!this.Ox&&c.not(".oj-disabled").length&&(this.Ox=!0,a.preventDefault(),this.ka&&this.ka.closest(c).length&&this.ka.get(0)!=c.get(0)||(c.has(".oj-menu").length?this.ze(a):(this.ng(a),this.element.is(":focus")||
(this.element.trigger("focus",[!0]),this.ka&&1===this.ka.parents(".oj-menu").length&&clearTimeout(this.vf)))))},"mouseenter .oj-menu-item":function(a){var c=f(a.currentTarget);c.siblings().children(".oj-focus-ancestor").removeClass("oj-focus-ancestor");this.Od(a,c)},mouseleave:function(a){this.cj(a,"eventSubtree")},"mouseleave .oj-menu":function(a){this.cj(a,"eventSubtree")},focus:function(a,c){if(!c){var e=this.ka||this.element.children(".oj-menu-item").eq(0);this.Od(a,e)}},keydown:this.zj,keyup:function(a){if(a.keyCode==
f.ui.keyCode.ENTER||a.keyCode==f.ui.keyCode.SPACE)this.rp=!1}});this.rb();this.qS();this._super()},qS:function(){var a=this.document.data(this.ip);a||(a=function(a){if("focus"===a.type||"mousedown"===a.type||93==a.which||121==a.which&&a.shiftKey||93==a.keyCode){var b=c.slice(0,c.length);f.each(b,function(b,c){!f(a.target).closest(c.element).length&&("keydown"===a.type||"mousedown"===a.type&&3===a.which||!f(a.target).closest(c.Kb).length||c.LQ&&"mousedown"===a.type&&3!==a.which)&&(c.cj(a,"eventSubtree"),
c.Kb&&c.qp(a))})}},this.document.data(this.ip,a),this.document[0].addEventListener("keydown",a,!0),this.document[0].addEventListener("mousedown",a,!0),this.document[0].addEventListener("focus",a,!0))},UT:function(){var a=this.document.data(this.ip);a&&1===f(":oj-menu").length&&(this.document[0].removeEventListener("keydown",a,!0),this.document[0].removeEventListener("mousedown",a,!0),this.document[0].removeEventListener("focus",a,!0),this.document.removeData(this.ip))},_setOption:function(b,c){this._superApply(arguments);
this.Kb||("submenuOpenOptions"===b?this.nr=a.de.Dg(c.position,this.yg):"submenuOpenOptions.position"===b&&(this.nr=a.de.Dg(c,this.yg)))},_destroy:function(){this.element.removeAttr("aria-activedescendant").find(".oj-menu").addBack().removeClass("oj-menu oj-component oj-menu-icons").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show();this.element.find(".oj-menu-item").removeClass("oj-menu-item").removeAttr("role").children("a").removeAttr("aria-disabled").removeUniqueId().removeClass("oj-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each(function(){var a=
f(this);a.data("oj-ojMenu-submenu-icon")&&a.remove()});this.element.find("a").removeAttr("aria-expanded");this.element.find(".oj-menu-divider").removeClass("oj-menu-divider").removeAttr("role");this.UT();0<=c.indexOf(this)&&c.splice(c.indexOf(this),1)},zj:function(a){function c(a){return a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$\x26")}var e,g,h,k,l=!0;switch(a.keyCode){case f.ui.keyCode.HOME:this.Tq("first","first",a);break;case f.ui.keyCode.END:this.Tq("last","last",a);break;case f.ui.keyCode.UP:this.YR(a);
break;case f.ui.keyCode.DOWN:this.TD(a);break;case f.ui.keyCode.LEFT:case f.ui.keyCode.RIGHT:a.keyCode===f.ui.keyCode.RIGHT^this.yg?this.ka&&!this.ka.is(".oj-disabled")&&this.ze(a):this.cj(a,"active");break;case f.ui.keyCode.ENTER:case f.ui.keyCode.SPACE:this.HP(a);this.rp=!0;var m=this;setTimeout(function(){m.rp=!1},100);break;case f.ui.keyCode.ESCAPE:this.Kb?(g=this.element.attr("aria-activedescendant"),h="#"+this.element.attr("id")+"\x3e*\x3ea",g&&!f("#"+g).is(h)?this.cj(a,"active"):this.wu(a)):
this.cj(a,"active");break;default:l=!1,e=this.ls||"",g=String.fromCharCode(a.keyCode),h=!1,clearTimeout(this.aV),g===e?h=!0:g=e+g,k=new RegExp("^"+c(g),"i"),e=this.Jj.children(".oj-menu-item").filter(function(){return k.test(f(this).children("a").text())}),e=h&&-1!==e.index(this.ka.next())?this.ka.nextAll(".oj-menu-item"):e,e.length||(g=String.fromCharCode(a.keyCode),k=new RegExp("^"+c(g),"i"),e=this.Jj.children(".oj-menu-item").filter(function(){return k.test(f(this).children("a").text())})),e.length?
(this.Od(a,e),1<e.length?(this.ls=g,this.aV=this._delay(function(){delete this.ls},1E3)):delete this.ls):delete this.ls}l&&a.preventDefault()},HP:function(a){this.ka.is(".oj-disabled")||(this.ka.children("a[aria-haspopup\x3d'true']").length?this.ze(a):this.ng(a))},refresh:function(){this._super();this.rb()},rb:function(){this.yg="rtl"===this.Ec();this.nr=a.de.Dg(this.options.submenuOpenOptions.position,this.yg);var b=this,c=this.element.find(this.options.menuSelector);c.filter(":not(.oj-menu)").addClass("oj-menu oj-component").hide().attr({role:this.role,
"aria-hidden":"true"}).each(function(){var a=f(this),c=b.gv(a),d=f("\x3cspan\x3e");d.addClass("oj-menu-submenu-icon oj-component-icon").data("oj-ojMenu-submenu-icon",!0);c.attr("aria-haspopup","true").attr("aria-expanded","false").prepend(d);c=c.attr("id");a.attr("aria-labelledby",c)});c=c.add(this.element).children();c.filter(".oj-menu-divider").has("a").removeClass("oj-menu-divider oj-menu-item").removeAttr("role");c.filter(":not(.oj-menu-item):has(a)").addClass("oj-menu-item").attr("role","presentation").children("a").uniqueId().attr({tabIndex:"-1",
role:"menuitem"});c.filter(":not(.oj-menu-item)").each(function(){var a=f(this);/[^\-\u2014\u2013\s]/.test(a.text())||a.addClass("oj-menu-divider").attr("role","separator")});c.filter(".oj-disabled").children("a").attr("aria-disabled","true");c.filter(":not(.oj-disabled)").children("a").removeAttr("aria-disabled");this.ka&&!f.contains(this.element[0],this.ka[0])&&this.wt()},gv:function(a){return a.prev("a")},KX:function(){return"menuitem"},Od:function(a,c){a&&"focus"===a.type||clearTimeout(this.vf);
c=c.first();this.DD(c,a);c.parent().closest(".oj-menu-item").children("a:first").addClass("oj-focus-ancestor");a&&"keydown"===a.type?this.zm():this.vf=this._delay(function(){this.zm()},this.delay);var e=c.children(".oj-menu");e.length&&a&&/^mouse/.test(a.type)&&!this.ka.hasClass("oj-disabled")&&this.DT(e);this.Jj=c.parent()},DD:function(a,c){if(!a.is(this.ka)){var e=this.ka?this.ka:f(),g=a.children("a");this.ka=a;this.element.attr("aria-activedescendant",g.attr("id"));e.children("a").removeClass("oj-focus");
g.addClass("oj-focus");this._trigger("_activeItem",c,{previousItem:e,item:a,privateNotice:"The _activeItem event is private.  Do not use."})}},xS:function(a){if(this.ka){var c=this.ka;this.ka=null;this.element.removeAttr("aria-activedescendant");c.children("a").removeClass("oj-focus");this._trigger("_activeItem",a,{previousItem:c,item:f(),privateNotice:"The _activeItem event is private.  Do not use."})}},wt:function(a){clearTimeout(this.vf);this.xS(a)},wu:function(a){this.Kb.focus();this.qp(a)},qp:function(a){this.element.hide().attr("aria-hidden",
"true");this.Kb=void 0;this._trigger("__dismiss",a,{});0<=c.indexOf(this)&&c.splice(c.indexOf(this),1)},open:function(b,d,e){d=f.extend({},this.options.openOptions,d);e=f.extend({},this.options.submenuOpenOptions,e);this.TR||(this.SR(),this.TR=!0);this.LQ=b?("mousedown"===b.type||"contextmenu"===b.type)&&3===b.which||93==b.which||121==b.which&&b.shiftKey:!1;if(this._trigger("beforeOpen",b,{openOptions:d})){var g=d.launcher;if((g="string"===f.type(g)?f(g):g)&&g.length){var h=this.element[0],k=c.slice(0,
c.length);f.each(k,function(a,c){c.element[0]!==h&&(c.cj(b,"eventSubtree"),c.Kb&&c.qp(b))});k=a.de.Dg(d.position,this.yg);null==k.of&&(k.of=b&&"contextmenu"===b.type?b:g);this.nr=a.de.Dg(e.position,this.yg);this.element.show().removeAttr("aria-hidden").position(k);d=d.initialFocus;((e="firstItem"===d)||"menu"===d)&&this.element.focus();e?this.Od(b,this.element.children().first()):this.wt(b);this.Kb=g;c.push(this)}else a.C.warn("When calling Menu.open(), must specify openOptions.launcher via the component option, method param, or beforeOpen listener.  Ignoring the call.")}},
SR:function(){this.element.css({position:"absolute"})},DT:function(a){clearTimeout(this.vf);"true"===a.attr("aria-hidden")&&(this.vf=this._delay(function(){this.zm();this.YD(a)},this.delay))},YD:function(a){var d=f.extend({of:this.ka},this.nr);clearTimeout(this.vf);this.element.find(".oj-menu").not(a.parents(".oj-menu")).hide().attr("aria-hidden","true");a.show().removeAttr("aria-hidden").position(d);this.gv(a).attr("aria-expanded","true");!this.Kb&&0>c.indexOf(this)&&c.push(this)},mt:function(a,
c,e){function g(){var e=c?h.element:f(a&&a.target).closest(h.element.find(".oj-menu"));e.length||(e=h.element);h.zm(e);h.wt(a);h.Jj=e}clearTimeout(this.vf);var h=this;e?this.vf=this._delay(g,e):g()},zm:function(a){a||(a=this.ka?this.ka.parent():this.element);var d=a.find(".oj-menu");d.hide().attr("aria-hidden","true");this.gv(d).attr("aria-expanded","false");a.find("a.oj-focus-ancestor").removeClass("oj-focus-ancestor");this.Kb||0<=c.indexOf(this)&&a===this.element&&c.splice(c.indexOf(this),1)},cj:function(b,
c){if(null==c||"active"===c){var e=this.Jj&&this.Jj.closest(".oj-menu-item",this.element);e&&e.length&&(this.zm(),this.Od(b,e))}else"all"===c||"eventSubtree"===c?this.mt(b,"all"===c,this.delay):a.C.warn("Invalid param "+c+" passed to Menu._collapse().  Ignoring the call.")},ze:function(a){var c=this.ka&&this.ka.children(".oj-menu ").children(".oj-menu-item").first();c&&c.length&&(this.YD(c.parent()),this._delay(function(){this.Od(a,c)}))},TD:function(a){this.Tq("next","first",a)},YR:function(a){this.Tq("prev",
"last",a)},FX:function(){return this.ka&&!this.ka.prevAll(".oj-menu-item").length},GX:function(){return this.ka&&!this.ka.nextAll(".oj-menu-item").length},Tq:function(a,c,e){var f;this.ka&&(f="first"===a||"last"===a?this.ka["first"===a?"prevAll":"nextAll"](".oj-menu-item").eq(-1):this.ka[a+"All"](".oj-menu-item").eq(0));f&&f.length&&this.ka||(f=this.Jj.children(".oj-menu-item")[c]());this.Od(e,f)},ng:function(b){if(!this.ka&&b&&b.target){var c=f(b.target).closest(".oj-menu-item");c.closest(this.element).length&&
this.DD(c,b)}this.ka?this.ka.has(".oj-menu").length||this.ka.is(".oj-disabled")?a.C.warn("Selecting a disabled menu item or parent menu item is not allowed."):(c={item:this.ka},this.mt(b,!0),this.Kb&&this.wu(b),this._trigger("select",b,c)):a.C.warn("Menu._select() called when no menu item is focused and no menu item can be inferred from event param.")}});var c=[]})()});
//# sourceMappingURL=oj-modular.map